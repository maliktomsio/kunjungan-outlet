<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sales Order ‚Äì Multi Rute</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
font-family:-apple-system,BlinkMacSystemFont,Arial;
margin:0;
background:#f4f6f9;
}

header{
background:linear-gradient(135deg,#0f172a,#1e3a8a);
color:white;
padding:25px;
border-radius:0 0 25px 25px;
text-align:center;
}

.card{
background:white;
margin:15px;
padding:18px;
border-radius:18px;
box-shadow:0 10px 25px rgba(0,0,0,.06);
}

input,select{
width:100%;
padding:12px;
margin-top:6px;
border-radius:12px;
border:1px solid #ddd;
font-size:15px;
}

button{
width:100%;
padding:14px;
border-radius:14px;
border:none;
font-size:16px;
margin-top:12px;
color:white;
background:#2563eb;
}

.btn2{background:#059669}
.btnEnd{background:#dc2626}
.btn3{background:#25D366}
.btnDel{background:#ef4444;padding:6px 10px;font-size:12px}

.visited{
background:#dcfce7;
color:#065f46;
font-weight:600;
}

.progressBox{margin-top:15px}

.bar{
height:16px;
background:#e5e7eb;
border-radius:10px;
overflow:hidden;
margin-top:6px;
}

.bar span{
display:block;
height:100%;
background:#22c55e;
width:0%;
}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
font-size:13px;
}

th,td{
padding:8px;
border-bottom:1px solid #eee;
}

.totalBox{
background:#0f172a;
color:white;
padding:15px;
border-radius:15px;
margin-top:15px;
text-align:center;
font-size:18px;
}
</style>
</head>

<body>

<header>
<h2>üì¶ SALES ORDER MULTI RUTE</h2>
<div>SEBRANG 1 & PASAR 1</div>
</header>

<div class="card">
<select id="rute" onchange="gantiRute()">
<option value="SEBRANG 1">SEBRANG 1</option>
<option value="PASAR 1">PASAR 1</option>
</select>

<input type="date" id="tgl">

<button class="btn2" onclick="mulaiHari()">‚ñ∂ Mulai Hari</button>
<button class="btnEnd" onclick="akhiriHari()">‚õî Akhiri Hari</button>

<div class="progressBox">
<b>üìç Progress Rute</b>
<div id="progressText">0 / 0 outlet</div>
<div class="bar"><span id="bar"></span></div>
</div>
</div>

<div class="card">
<select id="outlet"></select>

<input id="produk" placeholder="Nama Produk">
<input id="qty" type="number" placeholder="Qty">
<input id="harga" type="number" placeholder="Harga">

<button onclick="tambah()">‚ûï Simpan Order</button>
</div>

<div class="card">
<button class="btn2" onclick="exportExcel()">‚¨á Export Excel</button>
<button class="btn3" onclick="kirimWA()">üì≤ Kirim WhatsApp</button>

<table id="tbl"></table>
<div class="totalBox" id="totalHari"></div>
</div>

<script>
// ================= DATA RUTE =================

const RUTE = {

"SEBRANG 1":[
"A088 ‚Äì AMELIA BAKEKO","A095 ‚Äì AMOR KIOS","A120 ‚Äì AGORA TIMUR NUSANTARA",
"A124 ‚Äì AZIZAH KIOS","A129 ‚Äì APRI KIOS SEBRANG","D029 ‚Äì DILA KIOS",
"D044 ‚Äì DILLA KIOS PASIR PANJANG","E004 ‚Äì EMMI TAN BU",
"H040 ‚Äì HENDRO KOLAM AIR BESAR","I042 ‚Äì IBU HASNI NASKUN",
"J012 ‚Äì JOKO MAS","K018 ‚Äì KODAR MAS","K055 ‚Äì KIOS IRMA",
"M085 ‚Äì MAULANA KIOS","N003 ‚Äì NANDO","P032 ‚Äì PUTRA SOLO",
"R038 ‚Äì RS MISI SEBRANG","S050 ‚Äì SUMBER REJEKI PASIR PANJANG",
"S076 ‚Äì SINAR MERAPI","S091 ‚Äì SINAR MUDA KIOS (EBA)",
"S092 ‚Äì KANTIN SMAN 2 (SLAMET)","S111 ‚Äì SABYAN KIOS",
"S160 ‚Äì SIMPANG TIGA KIOS","T002 ‚Äì ANTO KIOS","Y014 ‚Äì YULI BAKEKO",
"F002 ‚Äì FADJRIN","R024 ‚Äì ROMAIKA KIOS","S037 ‚Äì SOKIMIN SEBRANG",
"D010 ‚Äì DICKY SEBRANG","A111 ‚Äì ALKA KIOS","B064 ‚Äì BEACHES CAFE"
],

"PASAR 1":[
"M077 MAMA PIPIN",
"W024 WA ODE MUTIARA BU",
"W034 WA ODE PASAR IKAN",
"S149 SCANVENGER",
"S110 SINAR ONING KIOS",
"S106 SASA MAMA ( RIDHO )",
"L018 LA ARIFIN PURNAMA ILAHI",
"L012 LA AFI",
"K052 WARUNG ES KASTIA",
"I043 IKA BAPAK ( PENJUAL PLASTIK )",
"H065 HARSUCI PESONA",
"H073 HENDRA THUMBURUNI",
"K051 KAYLA KIOS",
"E015 EVI MAMA",
"M110 MURNI KIOS (PASAR)",
"A145 ARI THUMBURUNI",
"S164 SINAR MANIS THUMBURUNI",
"A141 ANDALAS TOKO",
"C004 CAHAYA BARU",
"C005 CAHAYA MUTIARA ( HARTATI )",
"R016 ROS THUMBURUNI BU",
"N016 NURSULITAMA RUKO/RASA SAYANG MM",
"M056 MERIA MM",
"R032 RIA JAYA",
"W039 WARUNG NONA",
"B058 BUNDA WARUNG RUKO",
"C025 COTO MAKASSAR PASAR JALBAR",
"I019 IRIAN THUMBURUNI",
"I025 NASIR BU",
"O006 OPAN BAPAK",
"M111 MARDIAN"
]
};

// ==============================================

let orders = JSON.parse(localStorage.getItem("orders")) || [];
let activeDate = localStorage.getItem("activeDate");
let activeRute = localStorage.getItem("activeRute") || "SEBRANG 1";

rute.value = activeRute;

function gantiRute(){
activeRute = rute.value;
localStorage.setItem("activeRute", activeRute);
loadOutlet();
render();
}

function mulaiHari(){
if(!tgl.value) return alert("Pilih tanggal dulu");
activeDate = tgl.value;
localStorage.setItem("activeDate", activeDate);
loadOutlet();
render();
}

function akhiriHari(){
orders = orders.filter(o =>
!(o.tgl===activeDate && o.rute===activeRute)
);
localStorage.setItem("orders",JSON.stringify(orders));
render();
loadOutlet();
}

function loadOutlet(){
outlet.innerHTML='<option value="">Pilih Outlet</option>';

RUTE[activeRute].forEach(o=>{
const opt=document.createElement("option");
opt.value=o;
opt.textContent=o;

const sudah=orders.some(x =>
x.tgl===activeDate &&
x.outlet===o &&
x.rute===activeRute
);

if(sudah){
opt.textContent+=" ‚úì";
opt.classList.add("visited");
}
outlet.appendChild(opt);
});

updateProgress();
}

function tambah(){
const o={
tgl:activeDate,
rute:activeRute,
outlet:outlet.value,
produk:produk.value,
qty:+qty.value,
harga:+harga.value
};

o.total=o.qty*o.harga;
orders.push(o);

localStorage.setItem("orders",JSON.stringify(orders));

produk.value="";qty.value="";harga.value="";
loadOutlet();
render();
}

function render(){
let total=0;
let html=`<tr>
<th>Outlet</th><th>Produk</th>
<th>Qty</th><th>Total</th><th></th></tr>`;

orders.filter(o=>
o.tgl===activeDate &&
o.rute===activeRute
).forEach((o,i)=>{
html+=`
<tr>
<td>${o.outlet}</td>
<td>${o.produk}</td>
<td>${o.qty}</td>
<td>${o.total}</td>
<td><button class="btnDel" onclick="hapus(${i})">X</button></td>
</tr>`;
total+=o.total;
});

tbl.innerHTML=html;
totalHari.innerText="TOTAL : Rp "+total.toLocaleString("id-ID");

updateProgress();
}

function updateProgress(){
const dikunjungi=new Set(
orders.filter(o=>
o.tgl===activeDate &&
o.rute===activeRute
).map(o=>o.outlet)
).size;

const totalOutlet=RUTE[activeRute].length;
progressText.innerText=`${dikunjungi} / ${totalOutlet} outlet`;
bar.style.width=(dikunjungi/totalOutlet*100)+"%";
}

function kirimWA(){
let t=`*LAPORAN ${activeRute}*%0A%0A`;
orders.filter(o=>o.tgl===activeDate && o.rute===activeRute)
.forEach(o=>{
t+=`${o.outlet}%0A${o.produk} x${o.qty} = ${o.total}%0A%0A`;
});
window.open("https://wa.me/?text="+t);
}

function exportExcel(){
let csv="Rute,Tanggal,Outlet,Produk,Qty,Total\n";
orders.forEach(o=>{
csv+=`${o.rute},${o.tgl},${o.outlet},${o.produk},${o.qty},${o.total}\n`;
});
let a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([csv]));
a.download="laporan-multi-rute.csv";
a.click();
}

if(activeDate){
tgl.value=activeDate;
loadOutlet();
render();
}
</script>

</body>
</html>
