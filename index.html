<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sales Visit Enterprise</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- EXCEL XLSX -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<!-- CHART -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:-apple-system;background:#f4f6f9}
.hidden{display:none}
header{background:linear-gradient(135deg,#0f172a,#1e40af);color:#fff;
padding:25px;text-align:center;border-radius:0 0 25px 25px}
.card{background:#fff;margin:15px;padding:18px;border-radius:18px;
box-shadow:0 10px 25px rgba(0,0,0,.06)}
input,select,button{width:100%;padding:12px;border-radius:12px;margin-top:8px}
button{background:#2563eb;color:#fff;border:none;font-size:16px}
.btn2{background:#059669}
.btn3{background:#dc2626}
#map{width:100%;height:280px;border-radius:15px;margin-top:10px}
table{width:100%;border-collapse:collapse;font-size:13px;margin-top:10px}
th,td{padding:7px;border-bottom:1px solid #eee}
th{background:#f1f5f9}
</style>
</head>

<body>

<div id="login" class="card">
<h2>üîê Login Sales</h2>
<input id="sales" placeholder="Nama sales">
<button onclick="login()">Masuk</button>
</div>

<div id="app" class="hidden">

<header>
<h2>üìç SALES VISIT ENTERPRISE</h2>
<div id="salesName"></div>
</header>

<div class="card">
<input type="date" id="tgl">
<select id="outlet">
<option value="">Pilih Outlet</option>
<option>A088 ‚Äì AMELIA BAKEKO</option>
<option>A095 ‚Äì AMOR KIOS</option>
<option>A120 ‚Äì AGORA TIMUR NUSANTARA</option>
<option>A124 ‚Äì AZIZAH KIOS</option>
<option>A129 ‚Äì APRI KIOS SEBRANG</option>
<option>D029 ‚Äì DILA KIOS</option>
<option>D044 ‚Äì DILLA KIOS PASIR PANJANG</option>
<option>E004 ‚Äì EMMI TAN BU</option>
<option>H040 ‚Äì HENDRO KOLAM AIR BESAR</option>
<option>I042 ‚Äì IBU HASNI NASKUN</option>
<option>J012 ‚Äì JOKO MAS</option>
<option>K018 ‚Äì KODAR MAS</option>
<option>K055 ‚Äì KIOS IRMA</option>
<option>M085 ‚Äì MAULANA KIOS</option>
<option>N003 ‚Äì NANDO</option>
<option>P032 ‚Äì PUTRA SOLO</option>
<option>R038 ‚Äì RS MISI SEBRANG</option>
<option>S050 ‚Äì SUMBER REJEKI PASIR PANJANG</option>
<option>S076 ‚Äì SINAR MERAPI</option>
<option>S091 ‚Äì SINAR MUDA KIOS (EBA)</option>
<option>S092 ‚Äì KANTIN SMAN 2 (SLAMET)</option>
<option>S111 ‚Äì SABYAN KIOS</option>
<option>S160 ‚Äì SIMPANG TIGA KIOS</option>
<option>T002 ‚Äì ANTO KIOS</option>
<option>Y014 ‚Äì YULI BAKEKO</option>
<option>F002 ‚Äì FADJRIN</option>
<option>R024 ‚Äì ROMAIKA KIOS</option>
<option>S037 ‚Äì SOKIMIN SEBRANG</option>
<option>D010 ‚Äì DICKY SEBRANG</option>
<option>A111 ‚Äì ALKA KIOS</option>
<option>B064 ‚Äì BEACHES CAFE</option>
</select>

<button onclick="checkIn()">üü¢ CHECK-IN</button>
<button class="btn3" onclick="checkOut()">üî¥ CHECK-OUT</button>

<div id="map"></div>
</div>

<div class="card">
<button class="btn2" onclick="exportXLSX()">‚¨á Export Excel (.xlsx)</button>
<table id="tbl"></table>
</div>

</div>

<script>
let orders = JSON.parse(localStorage.getItem("visits")) || [];
let salesName = localStorage.getItem("sales");
let map, marker, current;

if(salesName){
login.style.display="none";
app.classList.remove("hidden");
document.getElementById("salesName").innerText="Sales: "+salesName;
}

function login(){
localStorage.setItem("sales",sales.value);
location.reload();
}

function initMap(lat,lng){
map=new google.maps.Map(document.getElementById("map"),{
center:{lat,lng},zoom:16
});
marker=new google.maps.Marker({position:{lat,lng},map});
}

function checkIn(){
navigator.geolocation.getCurrentPosition(pos=>{
current={
tgl:tgl.value,
outlet:outlet.value,
checkin:new Date().toLocaleTimeString(),
lat:pos.coords.latitude,
lng:pos.coords.longitude
};
initMap(current.lat,current.lng);
});
}

function checkOut(){
if(!current) return alert("Belum check-in");
current.checkout=new Date().toLocaleTimeString();
current.sales=salesName;
orders.push(current);
localStorage.setItem("visits",JSON.stringify(orders));
render();
alert("Kunjungan tersimpan");
}

function render(){
let html=`<tr>
<th>Tgl</th><th>Outlet</th><th>Check-in</th>
<th>Check-out</th><th>Sales</th></tr>`;
orders.forEach(o=>{
html+=`<tr>
<td>${o.tgl}</td>
<td>${o.outlet}</td>
<td>${o.checkin}</td>
<td>${o.checkout}</td>
<td>${o.sales}</td>
</tr>`;
});
tbl.innerHTML=html;
}

function exportXLSX(){
let ws=XLSX.utils.json_to_sheet(orders);
let wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Kunjungan");
XLSX.writeFile(wb,"laporan-kunjungan.xlsx");
}

render();
</script>

</body>
</html>
