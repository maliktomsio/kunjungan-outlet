<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sales Order Enterprise</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:-apple-system;background:#f4f6f9}
.hidden{display:none}
header{background:linear-gradient(135deg,#0f172a,#1e40af);color:#fff;
padding:25px;text-align:center;border-radius:0 0 25px 25px}
.card{background:#fff;margin:15px;padding:18px;border-radius:18px;
box-shadow:0 10px 25px rgba(0,0,0,.06)}
input,select{width:100%;padding:12px;margin-top:8px;border-radius:12px;border:1px solid #ddd}
button{width:100%;padding:14px;border:none;border-radius:14px;
background:#2563eb;color:#fff;font-size:16px;margin-top:12px}
.small{font-size:13px;color:#555}
table{width:100%;border-collapse:collapse;font-size:13px;margin-top:10px}
th,td{padding:7px;border-bottom:1px solid #eee}
th{background:#f1f5f9}
.del{background:#ef4444;padding:5px 8px;border-radius:8px}
.outletBox{padding:10px;border-bottom:1px solid #eee;cursor:pointer}
.popup{position:fixed;top:0;left:0;right:0;bottom:0;background:#0007;
display:none;align-items:center;justify-content:center}
.popupContent{background:#fff;padding:20px;border-radius:15px;width:90%}
</style>
</head>

<body>

<div id="login" class="card">
<h2>üîê Login Sales</h2>
<input id="sales" placeholder="Nama sales">
<button onclick="login()">Masuk</button>
</div>

<div id="app" class="hidden">

<header>
<h2>üì¶ SALES ORDER ENTERPRISE</h2>
<div id="salesName"></div>
</header>

<div class="card">
<input type="date" id="tgl">
<select id="outlet">
<option value="">Pilih Outlet</option>
<option>A088 ‚Äì AMELIA BAKEKO</option>
<option>A095 ‚Äì AMOR KIOS</option>
<option>A120 ‚Äì AGORA TIMUR NUSANTARA</option>
<option>A124 ‚Äì AZIZAH KIOS</option>
<option>A129 ‚Äì APRI KIOS SEBRANG</option>
<option>D029 ‚Äì DILA KIOS</option>
<option>D044 ‚Äì DILLA KIOS PASIR PANJANG</option>
<option>E004 ‚Äì EMMI TAN BU</option>
<option>H040 ‚Äì HENDRO KOLAM AIR BESAR</option>
<option>I042 ‚Äì IBU HASNI NASKUN</option>
<option>J012 ‚Äì JOKO MAS</option>
<option>K018 ‚Äì KODAR MAS</option>
<option>K055 ‚Äì KIOS IRMA</option>
<option>M085 ‚Äì MAULANA KIOS</option>
<option>N003 ‚Äì NANDO</option>
<option>P032 ‚Äì PUTRA SOLO</option>
<option>R038 ‚Äì RS MISI SEBRANG</option>
<option>S050 ‚Äì SUMBER REJEKI PASIR PANJANG</option>
<option>S076 ‚Äì SINAR MERAPI</option>
<option>S091 ‚Äì SINAR MUDA KIOS (EBA)</option>
<option>S092 ‚Äì KANTIN SMAN 2 (SLAMET)</option>
<option>S111 ‚Äì SABYAN KIOS</option>
<option>S160 ‚Äì SIMPANG TIGA KIOS</option>
<option>T002 ‚Äì ANTO KIOS</option>
<option>Y014 ‚Äì YULI BAKEKO</option>
<option>F002 ‚Äì FADJRIN</option>
<option>R024 ‚Äì ROMAIKA KIOS</option>
<option>S037 ‚Äì SOKIMIN SEBRANG</option>
<option>D010 ‚Äì DICKY SEBRANG</option>
<option>A111 ‚Äì ALKA KIOS</option>
<option>B064 ‚Äì BEACHES CAFE</option>
</select>

<input id="produk" placeholder="Produk">
<input id="qty" type="number" placeholder="Qty">
<input id="harga" type="number" placeholder="Harga">

<button onclick="tambah()">‚ûï Simpan + GPS</button>
</div>

<div class="card">
<select id="filter" onchange="render()">
<option value="all">Semua</option>
<option value="today">Hari ini</option>
<option value="week">Mingguan</option>
</select>

<canvas id="chart"></canvas>
</div>

<div class="card">
<h3>üìä Total per Outlet</h3>
<div id="rekap"></div>
</div>

<div class="card">
<table id="tbl"></table>
</div>

</div>

<div class="popup" id="popup" onclick="this.style.display='none'">
<div class="popupContent" id="popupContent"></div>
</div>

<script>
let orders=JSON.parse(localStorage.getItem("orders"))||[];
let sales=localStorage.getItem("sales");

if(sales){
login.style.display="none";
app.classList.remove("hidden");
salesName.innerText="Sales: "+sales;
}

function login(){
localStorage.setItem("sales",sales.value);
location.reload();
}

function tambah(){
navigator.geolocation.getCurrentPosition(pos=>{
orders.push({
tgl:tgl.value,
outlet:outlet.value,
produk:produk.value,
qty:+qty.value,
harga:+harga.value,
total:+qty.value*+harga.value,
lat:pos.coords.latitude,
lng:pos.coords.longitude
});
localStorage.setItem("orders",JSON.stringify(orders));
render();
});
}

function getFiltered(){
const f=filter.value;
const now=new Date();
return orders.filter(o=>{
const d=new Date(o.tgl);
if(f==="today") return d.toDateString()===now.toDateString();
if(f==="week") return (now-d)/(1000*60*60*24)<=7;
return true;
});
}

function render(){
const data=getFiltered();
let totalOutlet={};
let labels=[],values=[];

data.forEach(o=>{
totalOutlet[o.outlet]=(totalOutlet[o.outlet]||0)+o.total;
});

rekap.innerHTML="";
for(let k in totalOutlet){
rekap.innerHTML+=`<div class="outletBox"
onclick="detail('${k}')">${k}<br><b>${totalOutlet[k]}</b></div>`;
labels.push(k);
values.push(totalOutlet[k]);
}

new Chart(chart,{
type:'bar',
data:{labels,datasets:[{data:values}]},
options:{plugins:{legend:{display:false}}}
});

let html=`<tr><th>Tgl</th><th>Outlet</th><th>Total</th><th>GPS</th></tr>`;
data.forEach(o=>{
html+=`<tr>
<td>${o.tgl}</td>
<td>${o.outlet}</td>
<td>${o.total}</td>
<td class="small">${o.lat.toFixed(4)},${o.lng.toFixed(4)}</td>
</tr>`;
});
tbl.innerHTML=html;
}

function detail(out){
let d=orders.filter(o=>o.outlet===out);
let html=`<h3>${out}</h3>`;
d.forEach(x=>{
html+=`${x.tgl} - ${x.produk} (${x.qty}) = ${x.total}<br>`;
});
popupContent.innerHTML=html;
popup.style.display="flex";
}

render();
</script>

</body>
</html>
