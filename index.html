<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sales Order ‚Äì Rute Kunjungan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
font-family:-apple-system,BlinkMacSystemFont,Arial;
margin:0;
background:#f4f6f9;
}

header{
background:linear-gradient(135deg,#0f172a,#1e3a8a);
color:white;
padding:25px;
border-radius:0 0 25px 25px;
text-align:center;
}

.card{
background:white;
margin:15px;
padding:18px;
border-radius:18px;
box-shadow:0 10px 25px rgba(0,0,0,.06);
}

input,select{
width:100%;
padding:12px;
margin-top:6px;
border-radius:12px;
border:1px solid #ddd;
font-size:15px;
}

button{
width:100%;
padding:14px;
border-radius:14px;
border:none;
font-size:16px;
margin-top:12px;
color:white;
background:#2563eb;
}

.btn2{background:#059669}
.btn3{background:#25D366}
.btnDel{background:#ef4444;padding:6px 10px;font-size:12px}
.btnReset{background:#f59e0b}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
font-size:13px;
}

th,td{
padding:8px;
border-bottom:1px solid #eee;
}

th{background:#f1f5f9}

.totalBox{
background:#0f172a;
color:white;
padding:15px;
border-radius:15px;
margin-top:15px;
text-align:center;
font-size:18px;
}

.visited{
background:#dcfce7;
color:#065f46;
font-weight:600;
}

.progress{
text-align:center;
font-weight:bold;
margin-top:8px;
}
</style>
</head>

<body>

<header>
<h2>üì¶ SALES ORDER RUTE</h2>
<div>Monitoring Kunjungan Outlet</div>
</header>

<div class="card">

<select id="rute" onchange="loadOutlet()">
<option value="SEBRANG1">RUTE SEBRANG 1</option>
<option value="PASAR1">RUTE PASAR 1</option>
</select>

<input type="date" id="tgl">

<div class="progress" id="progress"></div>

<select id="outlet"></select>

<input id="produk" placeholder="Nama Produk">
<input id="qty" type="number" placeholder="Qty">
<input id="harga" type="number" placeholder="Harga">

<button onclick="tambah()">‚ûï Simpan Order</button>
<button class="btnReset" onclick="resetHari()">üîÅ Akhiri Hari (Reset)</button>

</div>

<div class="card">
<button class="btn2" onclick="exportExcel()">‚¨á Export Excel</button>
<button class="btn3" onclick="kirimWA()">üì≤ Kirim WhatsApp</button>

<table id="tbl"></table>

<div class="totalBox" id="totalHari"></div>
</div>

<script>

const ruteDB = {

SEBRANG1:[
"A088 ‚Äì AMELIA BAKEKO",
"A095 ‚Äì AMOR KIOS",
"A120 ‚Äì AGORA TIMUR NUSANTARA",
"A124 ‚Äì AZIZAH KIOS",
"A129 ‚Äì APRI KIOS SEBRANG",
"D029 ‚Äì DILA KIOS",
"D044 ‚Äì DILLA KIOS PASIR PANJANG",
"E004 ‚Äì EMMI TAN BU",
"H040 ‚Äì HENDRO KOLAM AIR BESAR",
"I042 ‚Äì IBU HASNI NASKUN",
"J012 ‚Äì JOKO MAS",
"K018 ‚Äì KODAR MAS",
"K055 ‚Äì KIOS IRMA",
"M085 ‚Äì MAULANA KIOS",
"N003 ‚Äì NANDO",
"P032 ‚Äì PUTRA SOLO",
"R038 ‚Äì RS MISI SEBRANG",
"S050 ‚Äì SUMBER REJEKI PASIR PANJANG",
"S076 ‚Äì SINAR MERAPI",
"S091 ‚Äì SINAR MUDA KIOS (EBA)",
"S092 ‚Äì KANTIN SMAN 2 (SLAMET)",
"S111 ‚Äì SABYAN KIOS",
"S160 ‚Äì SIMPANG TIGA KIOS",
"T002 ‚Äì ANTO KIOS",
"Y014 ‚Äì YULI BAKEKO",
"F002 ‚Äì FADJRIN",
"R024 ‚Äì ROMAIKA KIOS",
"S037 ‚Äì SOKIMIN SEBRANG",
"D010 ‚Äì DICKY SEBRANG",
"A111 ‚Äì ALKA KIOS",
"B064 ‚Äì BEACHES CAFE"
],

PASAR1:[
"M077 ‚Äì MAMA PIPIN",
"W024 ‚Äì WA ODE MUTIARA BU",
"W034 ‚Äì WA ODE PASAR IKAN",
"S149 ‚Äì SCANVENGER",
"S110 ‚Äì SINAR ONING KIOS",
"S106 ‚Äì SASA MAMA (RIDHO)",
"L018 ‚Äì LA ARIFIN PURNAMA ILAHI",
"L012 ‚Äì LA AFI",
"K052 ‚Äì WARUNG ES KASTIA",
"I043 ‚Äì IKA BAPAK (PENJUAL PLASTIK)",
"H065 ‚Äì HARSUCI PESONA",
"H073 ‚Äì HENDRA THUMBURUNI",
"K051 ‚Äì KAYLA KIOS",
"E015 ‚Äì EVI MAMA",
"M110 ‚Äì MURNI KIOS (PASAR)",
"A145 ‚Äì ARI THUMBURUNI",
"S164 ‚Äì SINAR MANIS THUMBURUNI",
"A141 ‚Äì ANDALAS TOKO",
"C004 ‚Äì CAHAYA BARU",
"C005 ‚Äì CAHAYA MUTIARA (HARTATI)",
"R016 ‚Äì ROS THUMBURUNI BU",
"N016 ‚Äì NURSULITAMA RUKO/RASA SAYANG MM",
"M056 ‚Äì MERIA MM",
"R032 ‚Äì RIA JAYA",
"W039 ‚Äì WARUNG NONA",
"B058 ‚Äì BUNDA WARUNG RUKO",
"C025 ‚Äì COTO MAKASSAR PASAR JALBAR",
"I019 ‚Äì IRIAN THUMBURUNI",
"I025 ‚Äì NASIR BU",
"O006 ‚Äì OPAN BAPAK",
"M111 ‚Äì MARDIAN"
]
};

let orders = JSON.parse(localStorage.getItem("orders")) || [];

function loadOutlet(){

const t = tgl.value;
const r = rute.value;

outlet.innerHTML='<option value="">Pilih Outlet</option>';

let total = ruteDB[r].length;
let sudah = 0;

ruteDB[r].forEach(o=>{

const opt=document.createElement("option");
opt.value=o;
opt.textContent=o;

const ada = orders.some(x=>x.tgl===t && x.outlet===o);

if(ada){
opt.textContent+=" ‚úì SUDAH";
opt.classList.add("visited");
sudah++;
}

outlet.appendChild(opt);

});

progress.innerText = `Progress: ${sudah} / ${total} Outlet`;
}

function tambah(){

if(!tgl.value || !outlet.value)
return alert("Tanggal & outlet wajib diisi");

orders.push({
tgl:tgl.value,
rute:rute.value,
outlet:outlet.value,
produk:produk.value,
qty:+qty.value,
harga:+harga.value,
total:qty.value*harga.value
});

localStorage.setItem("orders",JSON.stringify(orders));

produk.value="";
qty.value="";
harga.value="";

loadOutlet();
render();
}

function render(){

let html=`<tr>
<th>Tgl</th><th>Rute</th><th>Outlet</th>
<th>Produk</th><th>Qty</th><th>Total</th><th></th>
</tr>`;

let total=0;

orders.forEach((o,i)=>{

html+=`<tr>
<td>${o.tgl}</td>
<td>${o.rute}</td>
<td>${o.outlet}</td>
<td>${o.produk}</td>
<td>${o.qty}</td>
<td>${o.total}</td>
<td><button class="btnDel" onclick="hapus(${i})">X</button></td>
</tr>`;

total+=o.total;

});

tbl.innerHTML=html;
totalHari.innerText="TOTAL : Rp "+total.toLocaleString("id-ID");
}

function hapus(i){
orders.splice(i,1);
localStorage.setItem("orders",JSON.stringify(orders));
render();
loadOutlet();
}

function resetHari(){
if(confirm("Reset semua data hari ini?")){
orders = [];
localStorage.setItem("orders","[]");
render();
loadOutlet();
}
}

function exportExcel(){
let csv="Tanggal,Rute,Outlet,Produk,Qty,Harga,Total\n";
orders.forEach(o=>{
csv+=`${o.tgl},${o.rute},${o.outlet},${o.produk},${o.qty},${o.harga},${o.total}\n`;
});

let a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([csv]));
a.download="laporan-sales.csv";
a.click();
}

function kirimWA(){

let t="*LAPORAN SALES*%0A%0A";
let total=0;

orders.forEach(o=>{
t+=`${o.tgl} | ${o.rute}%0A${o.outlet}%0A${o.produk} x${o.qty} = ${o.total}%0A%0A`;
total+=o.total;
});

t+=`TOTAL : ${total}`;

window.open("https://wa.me/?text="+t);
}

tgl.addEventListener("change",loadOutlet);

loadOutlet();
render();

</script>

</body>
</html>
