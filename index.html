<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sales Order</title>

<style>
body{
  background:#0e1621;
  color:white;
  font-family:system-ui;
}
.app{
  max-width:420px;
  margin:auto;
  padding:10px;
}
.card{
  background:#16202a;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
}
select,input{
  width:100%;
  padding:8px;
  margin-top:5px;
  background:#0e1621;
  color:white;
  border:1px solid #2a3;
  border-radius:6px;
}
.row{
  display:grid;
  grid-template-columns:2fr 1fr 1fr;
  gap:5px;
  margin-top:6px;
}
.btn{
  background:#2a3;
  border:none;
  padding:8px;
  width:100%;
  border-radius:6px;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="app">

<h3>ORDER OUTLET</h3>

<div class="card">

<label>Pilih Rute</label>
<select id="rute" onchange="loadOutlet()">
<option value="SEBRANG1">SEBRANG 1</option>
<option value="PASAR1">PASAR 1</option>
</select>

<label>Outlet</label>
<select id="outlet"></select>

<label>Tanggal</label>
<input type="date" id="tgl">
</div>

<div class="card">
<div id="list"></div>
<button class="btn" onclick="tambah()">+ Tambah Produk</button>
</div>

<div class="card">
<h3>Total : Rp <span id="total">0</span></h3>
</div>

</div>

<script>
// ===== DATA RUTE SESUAI GAMBAR KAMU =====
const ruteDB = {

SEBRANG1:[
"A088 ‚Äì AMELIA BAKEKO",
"A095 ‚Äì AMOR KIOS",
"A120 ‚Äì AGORA TIMUR NUSANTARA",
"A124 ‚Äì AZIZAH KIOS",
"A129 ‚Äì APRI KIOS SEBRANG",
"D029 ‚Äì DILA KIOS",
"D044 ‚Äì DILLA KIOS PASIR PANJANG",
"E004 ‚Äì EMMI TAN BU",
"H040 ‚Äì HENDRO KOLAM AIR BESAR",
"I042 ‚Äì IBU HASNI NASKUN",
"J012 ‚Äì JOKO MAS",
"K018 ‚Äì KODAR MAS",
"K055 ‚Äì KIOS IRMA",
"M085 ‚Äì MAULANA KIOS",
"N003 ‚Äì NANDO",
"P032 ‚Äì PUTRA SOLO",
"R038 ‚Äì RS MISI SEBRANG",
"S050 ‚Äì SUMBER REJEKI PASIR PANJANG",
"S076 ‚Äì SINAR MERAPI",
"S091 ‚Äì SINAR MUDA KIOS (EBA)",
"S092 ‚Äì KANTIN SMAN 2 (SLAMET)",
"S111 ‚Äì SABYAN KIOS",
"S160 ‚Äì SIMPANG TIGA KIOS",
"T002 ‚Äì ANTO KIOS",
"Y014 ‚Äì YULI BAKEKO",
"F002 ‚Äì FADJRIN",
"R024 ‚Äì ROMAIKA KIOS",
"S037 ‚Äì SOKIMIN SEBRANG",
"D010 ‚Äì DICKY SEBRANG",
"A111 ‚Äì ALKA KIOS",
"B064 ‚Äì BEACHES CAFE"
],

PASAR1:[
"M077 ‚Äì MAMA PIPIN",
"W024 ‚Äì WA ODE MUTIARA BU",
"W034 ‚Äì WA ODE PASAR IKAN",
"S149 ‚Äì SCANVENGER",
"S110 ‚Äì SINAR ONING KIOS",
"S106 ‚Äì SASA MAMA ( RIDHO )",
"L018 ‚Äì LA ARIFIN PURNAMA ILAHI",
"L012 ‚Äì LA AFI",
"K052 ‚Äì WARUNG ES KASTIA",
"I043 ‚Äì IKA BAPAK ( PENJUAL PLASTIK )",
"H065 ‚Äì HARSUCI PESONA",
"H073 ‚Äì HENDRA THUMBURUNI",
"K051 ‚Äì KAYLA KIOS",
"E015 ‚Äì EVI MAMA",
"M110 ‚Äì MURNI KIOS (PASAR)",
"A145 ‚Äì ARI THUMBURUNI",
"S164 ‚Äì SINAR MANIS THUMBURUNI",
"A141 ‚Äì ANDALAS TOKO",
"C004 ‚Äì CAHAYA BARU",
"C005 ‚Äì CAHAYA MUTIARA ( HARTATI )",
"R016 ‚Äì ROS THUMBURUNI BU",
"N016 ‚Äì NURSULITAMA RUKO/RASA SAYANG MM",
"M056 ‚Äì MERIA MM",
"R032 ‚Äì RIA JAYA",
"W039 ‚Äì WARUNG NONA",
"B058 ‚Äì BUNDA WARUNG RUKO",
"C025 ‚Äì COTO MAKASSAR PASAR JALBAR",
"I019 ‚Äì IRIAN THUMBURUNI",
"I025 ‚Äì NASIR BU",
"O006 ‚Äì OPAN BAPAK",
"M111 ‚Äì MARDIAN"
]

};
// ===== END RUTE =====


// ===== PRODUK DARI PDF (TIDAK DIUBAH) =====
const produk = [
{nama:"OREO CHOCO ACTIVATION 110,4GR", pcs:8414, krt:201936},
{nama:"OREO CHOCO VANI WAFER 117GR", pcs:8356, krt:200544},
{nama:"OREO DARK & WHITE CHOC 110,4GR", pcs:8792, krt:211008},
{nama:"OREO DOUBLE CHOCO WAFER 117GR", pcs:8356, krt:200544},
{nama:"OREO PEANUT BUTTER & CHOCO", pcs:8792, krt:211008},
{nama:"OREO RED VELVET 110,4GR", pcs:9503, krt:228072},
{nama:"OREO SPACEBURST CREAM", pcs:7578, krt:181872},
{nama:"OREO STRAW CREAM", pcs:8414, krt:201936},
{nama:"OREO VANILLA 147,2GR", pcs:9487, krt:227688},

{nama:"POCARI SWEAT CAN 330ML", pcs:4850, krt:116400},
{nama:"POCARI SWEAT PET 350ML", pcs:5250, krt:126000},
{nama:"POCARI SWEAT PET 500ML", pcs:6250, krt:150000},
{nama:"POCARI SWEAT 900ML", pcs:10350, krt:155250},

{nama:"SOYJOY CHOCOLATE ALMOND", pcs:8025, krt:385200},
{nama:"SOYJOY DANISH CHEESE", pcs:8025, krt:385200},
{nama:"SOYJOY STRAWBERRY", pcs:8025, krt:385200},
{nama:"SOYJOY TROPICAL", pcs:8025, krt:385200},

{nama:"FRUITAMIN COCOBIT KELAPA", pcs:1062, krt:25488},
{nama:"FRUITAMIN STRAWBERRY", pcs:1062, krt:25488},

{nama:"M-150 BOTTLE", pcs:5020, krt:251000},
{nama:"M-150 CAN SLIM", pcs:6542, krt:157008},

{nama:"BISKUAT BITES CHOCOLATE", pcs:4840, krt:174240},
{nama:"BISKUAT BITES VANILA", pcs:4840, krt:174240},
{nama:"BISKUAT BOLU COKLAT", pcs:1951, krt:280944},
{nama:"BISKUAT GOLDEN STRAWBERRY", pcs:1909, krt:274896},

{nama:"KRAFT CHEDDAR LOAF 2KG", pcs:234451, krt:1875608},
{nama:"KRAFT CHEDDAR MINI", pcs:4961, krt:714384},
{nama:"KRAFT SINGLES 10S", pcs:22596, krt:677880},

{nama:"CAP KAKI TIGA ANAK LYCHEE", pcs:5167, krt:124008},
{nama:"CAP KAKI TIGA ANAK ORANGE", pcs:5167, krt:124008}

];
// ====== END DATA ======


function loadOutlet(){
let r = document.getElementById("rute").value;
let sel = document.getElementById("outlet");

sel.innerHTML="";

ruteDB[r].forEach(o=>{
 let op=document.createElement("option");
 op.textContent=o;
 sel.appendChild(op);
});
}

function format(x){
 return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");
}

function tambah(){
let id = Date.now();

let html = `
<div class="row">
<select onchange="hitung()">
<option value="">-- pilih produk --</option>
${produk.map((p,i)=>`
<option value="${i}">${p.nama}</option>
`).join("")}
</select>

<select onchange="hitung()">
<option value="pcs">PCS</option>
<option value="krt">KRT</option>
</select>

<input type="number" value="1" min="1" onkeyup="hitung()" onchange="hitung()">
</div>
`;

document.getElementById("list").insertAdjacentHTML("beforeend",html);
}

function hitung(){
let total = 0;

document.querySelectorAll(".row").forEach(r=>{
 let p = r.children[0].value;
 let satuan = r.children[1].value;
 let qty = r.children[2].value;

 if(p){
   let harga = produk[p][satuan];
   total += harga * qty;
 }
});

document.getElementById("total").innerText = format(total);
}

document.getElementById("tgl").value =
 new Date().toISOString().substr(0,10);

loadOutlet();
</script>
<!-- ====== FITUR TAMBAHAN TANPA MENGUBAH KODE ASLI ====== -->

<div class="app">

<div class="card">
<h3>üìä Progress Rute</h3>
<div id="progressInfo">0 / 0 Outlet</div>
</div>

<div class="card">
<button class="btn" onclick="simpanPerOutlet()">üíæ Simpan Order Outlet</button>
<button class="btn" onclick="kirimLaporanWA()">üì≤ Kirim Laporan WA</button>
<button class="btn" onclick="exportXLS()">üìÅ Export Excel</button>
</div>

</div>

<script>
// ===== STORAGE DATABASE =====
let DB = JSON.parse(localStorage.getItem("SALES_DB") || "{}");

// ===== SIMPAN PER OUTLET =====
function simpanPerOutlet(){

let tgl = document.getElementById("tgl").value;
let rute = document.getElementById("rute").value;
let outlet = document.getElementById("outlet").value;
let total = document.getElementById("total").innerText;

if(!tgl || !outlet){
  alert("Tanggal & outlet wajib diisi");
  return;
}

if(!DB[tgl]) DB[tgl] = {};
if(!DB[tgl][rute]) DB[tgl][rute] = {};

DB[tgl][rute][outlet] = {
  total: total,
  jam: new Date().toLocaleTimeString()
};

localStorage.setItem("SALES_DB", JSON.stringify(DB));

alert("Tersimpan:\n" + outlet);

updateProgress();
}

// ===== PROGRESS RUTE =====
function updateProgress(){

let tgl = document.getElementById("tgl").value;
let rute = document.getElementById("rute").value;

let totalOutlet = ruteDB[rute].length;
let selesai = 0;

if(DB[tgl] && DB[tgl][rute]){
  selesai = Object.keys(DB[tgl][rute]).length;
}

document.getElementById("progressInfo").innerText =
selesai + " / " + totalOutlet + " Outlet";
}

// ===== KIRIM LAPORAN WA =====
function kirimLaporanWA(){

let tgl = document.getElementById("tgl").value;
let rute = document.getElementById("rute").value;

if(!DB[tgl] || !DB[tgl][rute]){
  alert("Belum ada data tersimpan");
  return;
}

let txt = "*LAPORAN SALES*\n";
txt += "Tanggal: " + tgl + "\n";
txt += "Rute: " + rute + "\n\n";

for(let o in DB[tgl][rute]){
 txt += "‚Ä¢ " + o + "\n";
 txt += "  Total: Rp " + DB[tgl][rute][o].total + "\n";
 txt += "  Jam: " + DB[tgl][rute][o].jam + "\n\n";
}

window.open(
 "https://wa.me/?text=" +
 encodeURIComponent(txt)
);
}

// ===== EXPORT EXCEL =====
function exportXLS(){

let csv = "Tanggal,Rute,Outlet,Total,Jam\n";

for(let t in DB){
 for(let r in DB[t]){
  for(let o in DB[t][r]){

   csv +=
   t + "," +
   r + "," +
   o + "," +
   DB[t][r][o].total + "," +
   DB[t][r][o].jam + "\n";

  }
 }
}

let a = document.createElement("a");
a.href = URL.createObjectURL(
 new Blob([csv],{type:"text/csv"})
);

a.download = "laporan_sales.xlsx";
a.click();
}

// auto refresh progress
document.getElementById("rute")
.addEventListener("change", updateProgress);

document.getElementById("tgl")
.addEventListener("change", updateProgress);

setTimeout(updateProgress,500);

</script>
</body>
</html>
